<!doctype html>
<html>
<head>
    <base href="<%=basePath%>">
    <!--<title>短信平台</title>-->
    <meta http-equiv="Expires" content="0"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="${_static}/js/lib/bootstrap/css/bootstrap.css">
    <link type="text/css" rel="stylesheet" href="${_static}/js/lib/jqgrid/css/ui.jqgrid-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="${_static}/js/lib/ValidateForm/Validform.css">
    <link rel="stylesheet" href="${_static}/js/lib/zTree/css/zTreeStyle/zTreeStyle.css"/>
    <link rel="stylesheet" href="${_static}/themes/blue/css/ui.css">
    <link rel="stylesheet" href="${_static}/css/sys_com/com.css">
    <link rel="stylesheet" href="${_static}/css/core/module.css">
    <script src="${_static}/js/lib/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="${_static}/js/lib/jquery/jquery.cookie.js"  charset="utf-8"></script>
    <script type="text/javascript" src="${_static}/js/hengyun/hengyun_ajax.js"></script>
    <script type="text/javascript" src="${_static}/js/lib/jqgrid/js/jquery.jqGrid.js"></script>
    <script type="text/javascript" src="${_static}/js/lib/jqgrid/i18n/grid.locale-cn.js"></script>
    <script type="text/javascript" src="${_static}/js/hengyun/hengyun_ajax.js"></script>
    <script type="text/javascript" src="${_static}/js/lib/layer/layer.js" charset="utf-8"></script>
    <script type="text/javascript" src="${_static}/js/lib/jquery/jquery.cookie.js" charset="utf-8"></script>
    <script type="text/javascript" src="${_static}/js/hengyun/hengyun_ajax.js"></script>
    <script type="text/javascript" src="${_static}/js/lib/serializeJSON/jquery.serializejson.min.js"></script>
    <script type="text/javascript" src="${_static}/js/lib/ValidateForm/Validform_v5.3.2_min.js"></script>
    <script type="text/javascript" src="${_static}/js/lib/ValidateForm/Valid.js"></script>
    <script type="text/javascript" src="${_static}/js/hengyun/hengyun_resource.js"></script>
    <script type="text/javascript" src="${_static}/js/module.js"></script>
    <script type="text/javascript" src="${_static}/js/app.js"></script>
    <style type="text/css">
        #right-box {
            width: 100%;
            height: calc(100% - 65px);
            border: 0;
        }
        .inp-form{
            width:100px;
        }
    </style>
</head>

<body>
<div class="workspace-body">
    <div class="console-container clearfix">
        <div class="col-sm-12">
            <!-- begin 标题 -->
            <div class="console-title console-title-border clearfix">
                <div class="pull-left">
                    <h5 class="page-title">
                        日志管理系统 &gt;日志管理设置&gt;<span class="page-title-scend">日志保留设置</span>
                    </h5>
                </div>
                <div class="pull-right">
                </div>
            </div>
        </div>
        <div class="main">
        <div  style="height: 400px;width: 600px;border: 1px solid #fff;margin: auto;margin-top:70px;" >
            <div class="col-md-12 col-lg-12" style="margin-top:30px;">
                <div class="row">
                    <!--内容-->
                    <div class="list-section">
                        <div class="list-content">
                            <div class="form-inline">
                                <form id="dataForm" action="" method="post">
                                    <table class="table default-table table-title-left" >
                                        <input type="hidden" id="fileType" name="fileType">
                                        <input type="hidden" id="dataChannel" name="dataChannel">
                                        <tbody>
                                        <tr>
                                            <th>结构化日志保留</th>
                                            <td><input class="form-control inp-form" style="width: 10px;" id="structSaveDays" name="structSaveDays"
                                                      dataType="n1-3,positive" nullmsg="结构化日志保留天数不能为空！" errormsg="请填写1-3位正整数！"/>
                                            </td>
                                            <td >
                                                天
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>日志文件保留</th>
                                            <td><input class="form-control inp-form" style="width: 10px;" id="fileSaveDays" name="fileSaveDays"
                                                       dataType="n1-3,positive" nullmsg="日志文件保留天数不能为空！" errormsg="请填写1-3位正整数！"/>
                                            </td>
                                            <td >
                                                天
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>告警信息保留</th>
                                            <td><input class="form-control inp-form" style="width: 10px;" id="warnSaveDays" name="warnSaveDays"
                                                       dataType="n1-3,positive" nullmsg="告警信息保留天数不能为空！" errormsg="请填写1-3位正整数！"/>
                                            </td>
                                            <td >
                                                天
                                            </td>
                                        </tr>


                                        </tbody>
                                    </table>
                                    <button type="button" class="btn-submit hidden"></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="width:100%;height:100px;margin-top: 200px;">
                <div height="30px" style="margin-top: 50px;margin-left: 96px;">
                    <table width="80%">
                        <tr>
                            <td align="right">
                                <!--未做权限控制-->
                               <!-- <button type="button" class="btn btn-primary btnh" onclick="save()">确定</button>-->
                                <!--做权限控制-->
                                <script type="text/javascript" id="logs_keep_sure">
                                    resourceJs.init("${_gate_url!''}","${_app_id!''}","${l_u_i_s.id!''}").containButton({
                                        resource_code : "logs_keep_sure",
                                        btnHtml :"<button type=\"button\" class=\"btn btn-primary btnh\" onclick=\"save()\">确定</button>",
                                        htmlInsert: true
                                    });
                                 </script>
                            </td>
                            <td align="center">
                                <!--未做权限控制-->
                                <!--<button type="button" class="btn btn-primary btnh" onclick="recover()">恢复默认设置</button>-->
                                <!--做权限控制-->
                                <script type="text/javascript" id="logs_keep_restore">
                                    resourceJs.init("${_gate_url!''}","${_app_id!''}","${l_u_i_s.id!''}").containButton({
                                        resource_code : "logs_keep_restore",
                                        btnHtml :"<button type=\"button\" class=\"btn btn-primary btnh\" onclick=\"recover()\">恢复默认设置</button>",
                                        htmlInsert: true
                                    });
                                 </script>
                            </td>
                            <td>
                                <!--未做权限控制-->
                                <!--<button type="button" class="btn btn-primary btnh" onclick="reset()">重置</button>-->
                                <!--做权限控制-->
                                <script type="text/javascript" id="logs_keep_reset">
                                    resourceJs.init("${_gate_url!''}","${_app_id!''}","${l_u_i_s.id!''}").containButton({
                                        resource_code : "logs_keep_reset",
                                        btnHtml :"<button type=\"button\" class=\"btn btn-primary btnh\" onclick=\"reset()\">重置</button>",
                                        htmlInsert: true
                                    });
                                 </script>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        </div>
    </div>

</div>
<script type="text/javascript">
    var tableObj = null;//jqgrid表对象
    var fileListArray = [];//文档列表
    var checkName = [];


    ajaxHengyun({
        type: "GET",
        async: false,
        url: "${_gate_url}/api/logs/warn/getSetDay",
        datatype: 'json',
        success: function (rows) {
            
            if (rows.data) {
                $("#structSaveDays").val(rows.data.structSaveDays);
                $("#fileSaveDays").val(rows.data.fileSaveDays);
                $("#warnSaveDays").val(rows.data.warnSaveDays);
            }
        }
    });

    function save() {
        $('.btn-submit').click();
    }

    $('.btn-submit').valid({
        form: '#dataForm',
        //showAllError:可选项 true | false，true：提交表单时所有错误提示信息都会显示，
        //false：一碰到验证不通过的就停止检测后面的元素，只显示该元素的错误信息;
        showAllError: true,
        ignoreHidden: true,
        checkpassed: function () {
            saveObj();
        }
    });
    /*提交*/
    function saveObj() {
        var data = $("#dataForm").serializeJSON();
        
        ajaxHengyun({
            type: "POST",
            async: false,
            dataType: 'json',
            contentType: 'application/json',
            url: "${_gate_url}/api/logs/warn/updateSetDay",
            data: JSON.stringify(data),
            success: function (rows) {
                if (rows.data) {
                    parent.home.reloadJqgrid();
                    parent.layer.msg("保存成功！", {icon: 6, time: 1000});
                } else {
                    parent.layer.msg("保存出错，请重试！", {time: 1000});
                }
            }
        });
    };
    function recover(){
        parent.layer.confirm('您确定要恢复出厂设置吗？', {
            title: '温馨提示',
            shade: [0.4, '#000'],
            btn: ['确定', '取消'] //按钮
        }, function (value, index, elem) {
            ajaxHengyun({
                type: "GET",
                async: false,
                dataType: 'json',
                url: "${_gate_url}/api/logs/warn/recover",
                success: function (rows) {
                    if (rows.data) {
                        parent.home.reloadJqgrid();
                        parent.layer.msg("设置成功！", {icon: 6, time: 1000});
                    } else {
                        parent.layer.msg("设置失败，请稍后重试！", {time: 1000});
                    }
                }
            });
        }, function () {
            closeLayer();
        });
    }
    //刷新表格
    function reloadJqgrid() {
        ajaxHengyun({
            type: "GET",
            async: false,
            url: "${_gate_url}/api/logs/warn/getSetDay",
            datatype: 'json',
            success: function (rows) {
                if (rows.data) {
                    $("#structSaveDays").val(rows.data.structSaveDays);
                    $("#fileSaveDays").val(rows.data.fileSaveDays);
                    $("#warnSaveDays").val(rows.data.warnSaveDays);
                }
            }
        });
    }
    //重置
    function reset(){
        $('#structSaveDays').val("");
        $('#fileSaveDays').val("");
        $('#warnSaveDays').val("");
    }
</script>
</body>
</html>
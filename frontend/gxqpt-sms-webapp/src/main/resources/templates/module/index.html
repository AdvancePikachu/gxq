<html lang="en">

<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="Expires" content="0"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <!-- 外部CSS引入 -->
    <link type="text/css" rel="stylesheet" href="${_static}/js/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="${_static}/js/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="${_static}/themes/blue/css/ui.css?v=1.0.0">
    <link rel="stylesheet" type="text/css" href="${_static}/css/sms/com.css"/>
    <link rel="stylesheet" href="${_static}/css/core/module.css">
    <link rel="stylesheet" type="text/css" href="${_static}/css/sms/metisMenu.css"/>
    <link rel="stylesheet" type="text/css" href="${_static}/css/sms/message.css"/>
    <link rel="stylesheet" type="text/css" href="${_static}/css/core/sidenav.css?v=2">
    <title>短信管理系统</title>
    <style>
        html,body{
            height: 100%;
        }
        .layui-layer-page .layui-layer-title{
            background-color:#0188b6;
            color: #fff;
        }
        .layui-layer-page .layui-layer-content{
            padding-left: 10px;
        }
    </style>

</head>

<body>
<div class="view-framework">
    <!-- begin 顶部 -->
    <div class="index-top">
        <!-- begin logo -->
        <div class="index-logo">

            <ul id="navList1" class="navList">
                <li>
                    <!--<img class="pull-left" src="${_static}/images/logoImg.png" alt="" style="width: 40px;"/>-->
                    <span class="text-title">
                        "一体化基础系统共享平台"- 短信管理系统
                    </span>
                    <br/>
                    <span class="text-title" style="font-size: 10px">
                        SMS MANAGEMENT SYSTEM
					</span>
                </li>
                <li style="margin-top: 0px;"></li>
            </ul>
        </div>
        <!-- end logo -->
        <!-- begin 顶部快捷菜单 -->
        <div class="index-top-shortcut">
            <div id="tm" style="margin-right: 100px;"></div>
            <ul id="navList" class="navList">
            	<!--  
                <li id="index-top-msg" class="tubiao">
                    <a href="javascript:void(0);" onclick="openInfo()"> <img alt=""
                                                                             src="${_static}/images/core/index/switch.png">
                        <span class="img_text" id="message-notification" style="display:none;"></span>
                        <span>首页</span>
                    </a>
                </li>
                -->
                <li id="index-top-quit">
                    <a href="${_logout_url!''}"> <img alt="" src="${_static}/images/core/index/quit.png"> <span>首页</span>
                    </a>
                </li>
                <li id="index-top-msg">
                    <a id="conclusionShow" href="javascript:void(0);" data-title="消息列表" data-container="body" data-toggle="popover"  data-placement="bottom" data-trigger="click" data-html=true data-content="">
                        <img alt="" src="${_static}/images/core/index/msg.png">
                        <span>消息</span>
                        <span id="msgElement"></span>
                    </a>
                </li>
                <li id="index-top-userinfo" class="tubiao">
                    <a href="javascript:void(0);"  style="cursor:default">
                        <img alt="" src="${l_u_i_s.photo!''}"
                             onerror="this.onerror='';src='${_static}/images/core/index/user.png'", id="user_photo">
                        <span>${l_u_i_s.name!''}</span>
                    </a>
                    <!--  
                    <div class="navbar-ctrl" style="display:none;">
                        <div>
                            <a href="javascript:void(0);" onclick="deptOrUserInfo('');">个人信息</a>
                        </div>
                        <div>
                            <a href="javascript:void(0);" onclick="updatePassWord();">密码修改</a>
                        </div>
                    </div>
                    -->
                </li>
            </ul>
        </div>
        <!-- end 顶部快捷菜单 -->
    </div>
    <!-- end 顶部 -->
    <!-- begin 首页主体 -->
    <div class="view-framework-body view-framework-sidebar-full">
        <!-- begin 左边导航 -->
        <div class="view-framework-sidebar">
            <div class="sidebar-content">
                <div class="sidebar-inner">
                    <div class="sidebar-fold" style="background: #e7e7e7;color: #7b828a;font-size: 16px;height: 40px;line-height: 40px;">
                        <img width="20" height="20" style="margin-top: 9px;" src="${_static}/images/core/index/sidebar_close.png" />
                    </div>
                    <div class="sidebar-mask"></div>
                    <div class="sidebar-collapse">
                        <ul class="metismenu" id="menu">
                            <li class="active">
                                <ul class="nav" id="side-menu">
                                </ul>
                           </li>
                        </ul>
                    </div>
                </div>
                <!-- end 左边导航 -->
            </div>
        </div>
        <!-- begin 工作区 -->
        <div class="view-framework-main" style="background: #f5f5f5;">
            <div class="view-framework-head" style="border-bottom: 1px solid #ddd;">
                <div class="view-head-content" id="daohang">
                    短信管理系统 ><span class="title_first">首页</span><i></i><span class="title_second"
                                                                              style="color: #0e66c8;"></span>
                </div>
            </div>
            <div class="view-framework-workspace" style="width: 97%;margin: 0 auto;padding-top: 15px;">
                <iframe id="home" name="home" frameborder="0" scrolling="no" width="100%" height="100%"
                        src="${_cp}/module/home"></iframe>
            </div>
        </div>

        <!-- end 工作区 -->
    </div>
    <!-- end 首页主体 -->
</div>

<!-- 外部JS引入 -->
<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.cookie.js" charset="utf-8"></script>
<script type="text/javascript" src="${_static}/js/hengyun/hengyun_ajax.js"></script>
<script type="text/javascript" src="${_static}/js/hengyun/hengyun_resource.js"></script>




<!--<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.cookie.js"></script>-->
<script src="${_static}/js/lib/metisMenu/jquery.metisMenu.js"></script>
<script src="${_static}/js/lib/bootstrap/3.3.6/bootstrap.min.js"></script>
<script src="${_static}/js/lib/metisMenu/hplus.min.js"></script>
<script src="${_static}/js/lib/tipsy/jquery.tipsy.js"></script>
<script src="${_static}/js/lib/layer/layer.js"></script>
<script src="${_static}/js/index.js"></script>
<script src="${_static}/js/bootstrap-treeview.js" type="text/javascript" charset="utf-8"></script>
<script>
	var userId = "${l_u_i_s.id}";
    var gateUrl="${_gate_url}";
</script>
<script type="text/javascript" src="${_static}/js/com_msg.js"></script>
<!-- 自定义JS -->
<script type="text/javascript">
	var id = "${l_u_i_s.id}";
    //    置顶
    if (window.top!=window.self){
        top.location.href="${_cp!''}/module/index";
    }
    $(function () {
        $('#menu').metisMenu();
    });
    /*var startTime = new Date(); //开始时间
    var endTime = new Date(); //结束时间 服务器时间
    var timeEquation = Math.abs(new Date(endTime).getTime() - new Date(startTime).getTime()); //时间差的毫秒数
    var days = Math.floor(timeEquation / (24 * 3600 * 1000));
    //计算出小时数
    var leave1 = timeEquation % (24 * 3600 * 1000); //计算天数后剩余的毫秒数
    var hours = Math.floor(leave1 / (3600 * 1000));
    var leave2 = leave1 % (3600 * 1000); //计算小时数后剩余的毫秒数
    //计算相差分钟数
    var minutes = Math.floor(leave2 / (60 * 1000));
    //计算相差秒数
    var leave3 = leave2 % (60 * 1000); //计算分钟数后剩余的毫秒数
    //计算出相差天数
    var seconds = Math.round(leave3 / 1000);
    var updateUserName = "${l_u_i_s.name!''}";
    str = "当前用户："+updateUserName+"在线时长 :" + (hours <= 9 ? ('0' + hours) : hours) + "小时" + (minutes <= 9 ? ('0' + minutes) : minutes) + "分钟" + (seconds <= 9 ? ('0' + seconds) : seconds) + "秒";
    $("#tm").text(str);
    setInterval("show()", 1000);

    function show() {
        seconds++;
        if (seconds > 59) {
            seconds = 0;
            minutes++;
            if (minutes > 59) {
                minutes = 0;
                hours++;
            }
        }
        str = "当前用户： " + updateUserName + " 在线时长 :" + (hours <= 9 ? ('0' + hours) : hours) + "小时" + (minutes <= 9 ? ('0' + minutes) : minutes) + "分钟" + (seconds <= 9 ? ('0' + seconds) : seconds) + "秒";
        $("#tm").text(str);
    };*/

    //信息按钮点解事件
    function openInfo() {
        layer.open({
            type: 2,
            id: 'addPerson',
            title: '消息提醒列表',
            shadeClose: false,
            scrollbar: false,
            shade: 0.4,
            area: ['80%', '88%'],
            content: "${_cp }/comm/toMyMsg.do",
            btn: ['关闭'],
            end: msgNum,
        });
    }

    var li_count = $('.index-top-shortcut ul li').length;
    var othis;
    $('.index-top-shortcut ul li').each(function (index) {
        othis = $(this);
        othis.animate({
            'right': othis.outerWidth() * (li_count - index - 1),
            'opacity': 1
        }, 1000);
    });

    function deptOrUserInfo(personType) {
        var contentUrl = '';
        var title = '';
        /* if (personType == 1) {
         contentUrl = "
         ${_cp }/sysmnt/dept/deptInfo.do";
         title = '基本信息';
         } else if (personType == 0) {*/
        contentUrl = "${_cp }/comm/userDetails.do?id="+id;
        title = '个人信息';
        //        }
        layer.open({
            type: 2,
            id: 'deptOrUserInfo',
            title: title,
            shadeClose: false,
            scrollbar: false,
            shade: 0.4,
            area: ['80%', '78%'],
            content: contentUrl,
            btn: ['关闭']
        });
    }

    function updatePassWord() {
        layer.open({
            type: 2,
            id: 'updatePassWord',
            title: '密码修改',
            shadeClose: false,
            scrollbar: false,
            shade: 0.4,
            area: ['40%', '50%'],
            content: "${_cp }/comm/toUpdatePwd.do?id="+id,
            btn: ['<span class="glyphicon glyphicon-ok"></span>确定', '<span class="glyphicon glyphicon-backward"></span>关闭'],
            yes: function (index, layero) {
                var html = layero.context
                var Id = html.getElementById("updatePassWord");
                var iframe = $(Id).find("iframe").attr("name");
                parent[iframe].sub()
            }
        });
    }

    $(function () {
        $("#index-top-userinfo").hover(function () {
            $(".navbar-ctrl").show();
        }, function () {
            $(".navbar-ctrl").hide();
        });
        //菜单栏内容
        //查询菜单
        $("#daohang").hide();
        var menuList = resourceJs.init("${_gate_url!''}","${_app_id!''}","${l_u_i_s.id!''}").findMenu({cache:true});
        var menuHtml = "";
        if(!menuList){
            menuList=[];
        }
        var params = window.location.search;
        var paramsUrl = "";
        if(params) {
            var paramsUrl = params.split("=");
        };
        if(menuList.length>0) {
            var htm = '';
            for (var i = 0; i < menuList.length; i++) {
                var isChildren = false;
                var obj = menuList[i];
                var menuUrlName = obj.url.split("?")[0];
                if (menuUrlName == paramsUrl[1]) {
                    htm += '<li class="active">';
                    htm += '<a href="' + obj.url + '" aria-expanded="true" target="home">';
                } else {
                    if (menuList[i].children) {
                        for (var m = 0; m < menuList[i].children.length; m++) {
                            var childrenUrl = menuList[i].children[m].url.split("?")[0];
                            if (paramsUrl[1] == childrenUrl) {
                                isChildren = true;
                                hasChildrenSet = true;
                            }
                        }
                    }
                    if (isChildren) {
                        htm += '<li class="active">';
                        htm += '<a href="' + obj.url + '" aria-expanded="true" target="home">';
                    } else {
                        if (i == 0) {
                            htm += '<li class="active">';
                            htm += '<a href="' + obj.url + '" aria-expanded="true" target="home">';
                        } else {
                            htm += '<li>';
                            htm += '<a href="' + obj.url + '" aria-expanded="false" target="home">';
                        }
                    }
                }
                //htm += 'target="home">';
                htm += '<span class="navicon ' + obj.icon + '" style="font-size: 24px;margin-right: 5px;"></span>';
                htm += '<span class="sidebar-nav-item">' + obj.name + '</span>';
                if (menuList[i].children && menuList[i].children.length > 0) {
                    htm += '<span class="fa arrow"></span>';
                }
                htm += '</a>';
                if (menuList[i].children) {
                    if (isChildren) {
                        htm += '<ul aria-expanded="true">';
                    } else {
                        if (i == 0) {
                            htm += '<ul aria-expanded="true">';
                        } else {
                            htm += '<ul>';
                        }
                    }

                    for (var j = 0; j < menuList[i].children.length; j++) {
                        var childUrl = menuList[i].children[j].url.split("?")[0];
                        if (paramsUrl[1] == childUrl) {
                            htm += ' <li class="active" style="padding-left: 20%;">';
                            htm += '<a href="' + menuList[i].children[j].url + '" class="tab_nei" target="home" style="color: rgb(99, 181, 219);">';
                        } else {
                            htm += ' <li style="padding-left: 20%;">';
                            htm += '<a href="' + menuList[i].children[j].url + '" class="tab_nei" target="home">';
                        }
                        htm += menuList[i].children[j].name + '</a>';
                        if (i == 0 && j == 0) {
                            $("#home").attr("src", menuList[i].children[j].url);
                        }
                    }
                    htm += '</ul>';
                } else {
                    if (i == 0) {
                        $("#home").attr("src", obj.url);
                    }
                }
                htm += '</li>';
            }
            $("#daohang").show();
            $("#side-menu").html(htm);
            var params = window.location.search;
            var paramsUrl = "";
            if(params){
                var paramsUrl = params.split("=");
                if(paramsUrl.length==2){
                    $("#home").attr("src", paramsUrl[1]);
                }else if(paramsUrl.length>2){
                    paramsUrl.splice(0,1);
                    var url = paramsUrl.join("=");
                    $("#home").attr("src", url);
                }
            };
            $("body").on("click","#side-menu>li", function (e) {
                $("#side-menu>li").removeClass("active");
                $(this).addClass("active");
            });
            $("body").on("click","#side-menu ul li", function (e) {
                $("#side-menu ul li").removeClass("active");
                $(this).addClass("active");
            });
            var menuLi = $("#side-menu>li");
            menuLi.each(function(index,val){
                var aHref = $(val).find("a").attr("href");
                if(aHref==paramsUrl){
                    $(val).click();
                }else{
                    var ulMenu = $(val).find("ul li");
                    if(ulMenu){
                        ulMenu.each(function(num,ele){
                            var aHrefSecend = $(ele).find("a").attr("href");
                            if(aHrefSecend==paramsUrl){
                                $(ele).click();
                            }
                        })
                    }
                }
            });
            $("#side-menu").metisMenu();
        } else {
            $("#home").attr('src', '');
        }
        var params = window.location.search;
        if(params){
            var paramsUrl = params.split("=")[1];
            $("#home").attr("src", paramsUrl);
        };
        //var htm='<li class="active"><a href="#" aria-expanded="true"><span class="sidebar-nav-item-icon fa  fa-external-link fa-lg style="font-size: 24px;margin-right: 5px;"></span><span class="sidebar-nav-item">信息发送</span><span class="fa arrow"></span></a><ul aria-expanded="true"> <li style="padding-left: 20%;"><a href="/gxqpt-sms/sms/createShortMessage" class="tab_nei" target="home" style="color: #63b5db;">新建发送</a></li> <li style="padding-left: 20%;"><a href="/gxqpt-sms/sms/shortDrafts" class="tab_nei" target="home">草稿箱</a></li> <li style="padding-left: 20%;"><a href="/gxqpt-sms/sms/publishShortSucess" class="tab_nei" target="home">已发送</a></li></ul></li><li><a href="#" aria-expanded="false"><span class="sidebar-nav-item-icon fa  fa-calendar style="font-size: 24px;margin-right: 5px;"></span><span class="sidebar-nav-item">模板配置管理</span><span class="fa arrow"></span></a><ul aria-expanded="false"> <li style="padding-left: 20%;"><a href="/gxqpt-sms/sms/smsModel" class="tab_nei" target="home">模板配置管理</a></li></ul></li><li><a href="#" aria-expanded="false"><span class="sidebar-nav-item-icon fa  fa-cogs style="font-size: 24px;margin-right: 5px;"></span><span class="sidebar-nav-item">服务账号管理</span><span class="fa arrow"></span></a><ul aria-expanded="false"> <li style="padding-left: 20%;"><a href="/gxqpt-sms/sms/smsNum" class="tab_nei" target="home">服务账号管理</a></li></ul></li><li><a href="#" aria-expanded="false"><span class="sidebar-nav-item-icon fa  fa-bar-chart style="font-size: 24px;margin-right: 5px;"></span><span class="sidebar-nav-item">统计分析</span><span class="fa arrow"></span></a><ul aria-expanded="false"> <li style="padding-left: 20%;"><a href="/gxqpt-sms/sms/smsUse" class="tab_nei" target="home">短信使用情况分析</a></li> <li style="padding-left: 20%;"><a href="/gxqpt-sms/sms/modelUse" class="tab_nei" target="home">模板使用情况</a></li></ul></li>';
        //$("#side-menu").html(htm);

        $(".tab_nei").click(function () {
            $(".title_second").html($(this).html())
            var title_first = $(this).parent().parent().siblings("a").find(".sidebar-nav-item").html()
            $(".title_first").html(title_first +'>')
            $(".tab_nei").css({"color": "#66707a"})
            $(this).css({"color": "#63b5db"})
        })

        $('a[target="home"]').on('click', function () {
            var text = $(this).find('.sidebar-nav-item').eq(0).text();
            if (text) {
                $('.title_first').text(text);
                $('.title_second').text('');
            }
        });
    });
    $("#conclusionShow").popover({
        html: true,
        content: '<div id="content"></div>'
    }).on("mouseenter", function () {
        var _this = this;   // 这里的this触发的dom,需要存起来 否则在下面 .popover的逻辑中this会变为弹出的dom
        var isShow=$(".popover");
        if(isShow.length==0){
            $(_this).popover("show");
        };
    }).on("mouseleave", function () {
        var _this = this;
        setTimeout(function () {
            if (!$(".popover:hover").length) {
                $(_this).popover("hide");
            }
        }, 300);
    }).on("mousemove",function(){
        var isShow=$(".popover");
        if(isShow.length==0) {
            $("#conclusionShow").popover("show");
        }
    }).on('shown.bs.popover', function () {
        var ps =  $(".popoverCss li p.ptitle");
        for (var i = 0; i < ps.length; i++) {
            if(ps[i].offsetHeight > 40){
                var html = ps[i].innerText;
                var temp = "";
                ps[i].innerText = temp;
                var j = 0;
                while(ps[i].offsetHeight <= 40){
                    temp = html.substring(0, j+1);
                    j++;
                    ps[i].innerText = temp;
                }
                var leng = temp.length-2;
                ps[i].innerText=temp.substring(0,leng)+"···";
            }
        }
    });
    $("body").on("mouseleave",".popover", function () {
        setTimeout(function () {
            if (!$("#conclusionShow:hover").length) {
                $("#conclusionShow").popover("hide");
            }
        }, 300);
    });
    $("#conclusionShow").click (function(){
        window.open(gateUrl+'/gxqpt-center/admin/home?type=all');
    }) ;
</script>

</body>

</html>
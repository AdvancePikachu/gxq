<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="Expires" content="0"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <!-- 外部CSS引入 -->
    <link type="text/css" rel="stylesheet" href="${_static}/js/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="${_static}/js/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="${_static}/css/core/sidenav.css">
    <link rel="stylesheet" href="${_static}/themes/blue/css/ui.css?v=1.0.0">
    <link rel="stylesheet" type="text/css" href="${_static}/css/sys_com/com.css"/>
    <link rel="stylesheet" href="${_static}/css/core/module.css">
    <!--<link rel="icon" href="" type="image/x-icon" />-->
    <title>模块监控系统</title>
    <style>
        .index-logo{
            width: 36%;
            top: 16px;
        }
        .index-logo img{
            width: 40px;
            margin-top: -4px;
            margin-right: 5px;
        }
        .index-logo .text-title{
            font-size: 20px;
        }
    </style>
</head>
<body>
<div class="view-framework">
    <!-- begin 顶部 -->
    <div class="index-top">
        <!-- begin logo -->
        <div class="index-logo">
            <ul id="navList1" class="navList">
                <li>
                    <!--<img class="pull-left" src="${_static}/images/logoImg.png" alt=""/>-->
                    <span class="text-title">
                        "一体化基础系统共享平台"- 模块监控系统
                    </span>
                    <br/>
                    <span class="text-title" style="font-family:'楷体';font-size: 10px;">
                        MODULE MONITORING SYSTEM
                    </span>
                </li>
                <li style="margin-top: 0px;"></li>
            </ul>
        </div>
        <!-- end logo -->
        <!-- begin 顶部快捷菜单 -->
        <div class="index-top-shortcut">
            <div id="tm" style="margin-right: 100px;"></div>
            <ul id="navList" class="navList">
                <li id="index-top-quit">
                    <a href="${_logout_url}"> <img alt="" src="${_static}/images/core/index/quit.png">
                        <span>首页</span>
                    </a>
                </li>
                <li id="index-top-msg">
                    <a id="conclusionShow" href="javascript:void(0);" data-title="消息列表" data-container="body" data-toggle="popover"  data-placement="bottom" data-trigger="click" data-html=true data-content="">
                        <img alt="" src="${_static}/images/core/index/msg.png">
                        <span>消息</span>
                        <span id="msgElement"></span>
                    </a>
                </li>
                <li id="index-top-userinfo" class="tubiao">
                    <a href="javascript:void(0);"  style="cursor:default">
						<img id="user_photo" alt="" src="${l_u_i_s.photo!''}" onerror="this.onerror='';src='${_static}/images/core/index/user.png'">
						<span>${l_u_i_s.name}</span>
					</a>
                </li>
            </ul>
        </div>
        <!-- end 顶部快捷菜单 -->
    </div>
    <!-- end 顶部 -->
    <!-- begin 首页主体 -->
    <div class="view-framework-body view-framework-sidebar-full">
        <!-- begin 左边导航 -->
        <div class="view-framework-sidebar">
            <div class="sidebar-content">
                <div class="sidebar-inner">
                    <div class="sidebar-fold">
                        <!--<i class="fa fa-navicon fa-lg"></i>-->
                        <img width="22" height="22" style="margin-top: 9px;"
                             src="${_static}/images/core/index/sidebar_close.png"/>
                    </div>
                    <div class="sidebar-mask"></div>
                    <div class="sidebar-collapse">
                        <ul class="nav" id="side-menu">
                        </ul>
                    </div>
                </div>
                <!-- end 左边导航 -->
            </div>
        </div>
        <!-- begin 工作区 -->
        <div class="view-framework-main">
            <div class="view-framework-workspace">
                <iframe id="home" name="home" frameborder="0" scrolling="no" width="100%" height="100%"
                        src="${_cp}/modular/home">
                </iframe>
            </div>
        </div>
        <!-- end 工作区 -->
    </div>
    <!-- end 首页主体 -->
</div>
<!-- 外部JS引入 -->
<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.cookie.js" charset="utf-8"></script>
<script type="text/javascript" src="${_static}/js/hengyun/hengyun_ajax.js"></script>
<script type="text/javascript" src="${_static}/js/hengyun/hengyun_resource.js"></script>

<script src="${_static}/js/lib/metisMenu/jquery.metisMenu.js"></script>
<script src="${_static}/js/lib/bootstrap/3.3.6/bootstrap.min.js"></script>
<script src="${_static}/js/lib/metisMenu/hplus.min.js"></script>
<script src="${_static}/js/lib/tipsy/jquery.tipsy.js"></script>
<script src="${_static}/js/lib/layer/layer.js"></script>
<script src="${_static}/js/index.js"></script>
<script>
    var userId = "${l_u_i_s.id}";
    var gateUrl="${_gate_url}";
</script>
<script type="text/javascript" src="${_static}/js/com_msg.js"></script>
<!-- 自定义JS -->
<script type="text/javascript">
    //    置顶
    if (window.top!=window.self){
        top.location.href="${_cp!''}/module/index";
    }
    /*var startTime = new Date(); //开始时间
    var endTime = new Date(); //结束时间 服务器时间
    var timeEquation = Math.abs(new Date(endTime).getTime() - new Date(startTime).getTime()); //时间差的毫秒数
    var days = Math.floor(timeEquation / (24 * 3600 * 1000));
    //计算出小时数
    var leave1 = timeEquation % (24 * 3600 * 1000); //计算天数后剩余的毫秒数
    var hours = Math.floor(leave1 / (3600 * 1000));
    var leave2 = leave1 % (3600 * 1000); //计算小时数后剩余的毫秒数
    //计算相差分钟数
    var minutes = Math.floor(leave2 / (60 * 1000));
    //计算相差秒数
    var leave3 = leave2 % (60 * 1000); //计算分钟数后剩余的毫秒数
    //计算出相差天数
    var seconds = Math.round(leave3 / 1000);
    var currentUserName = "${l_u_i_s.name}";
    str = "当前用户：" + currentUserName + "  在线时长 :" + (hours <= 9 ? ('0' + hours) : hours) + "小时" + (minutes <= 9 ? ('0' + minutes) : minutes) + "分钟" + (seconds <= 9 ? ('0' + seconds) : seconds) + "秒";
    $("#tm").text(str);
    setInterval("show()", 1000);
    function show() {
        seconds++;
        if (seconds > 59) {
            seconds = 0;
            minutes++;
            if (minutes > 59) {
                minutes = 0;
                hours++;
            }
        }
        str = "当前用户：" + currentUserName + "  在线时长 :" + (hours <= 9 ? ('0' + hours) : hours) + "小时" + (minutes <= 9 ? ('0' + minutes) : minutes) + "分钟" + (seconds <= 9 ? ('0' + seconds) : seconds) + "秒";
        $("#tm").text(str);
    }*/

    var li_count = $('.index-top-shortcut ul li').length;
    var othis;
    $('.index-top-shortcut ul li').each(function (index) {
        othis = $(this);
        othis.animate({
            'right': othis.outerWidth() * (li_count - index - 1),
            'opacity': 1
        }, 1000);
    });

    $(function () {
        $("#index-top-userinfo").hover(function () {
            $(".navbar-ctrl").show();
        }, function () {
            $(".navbar-ctrl").hide();
        });
        //查询菜单
        var params = window.location.search;
        var paramsUrl = "";
        if(params){
            paramsUrl = params.split("=")[1];
        };
        var menuList = resourceJs.init("${_gate_url!''}","${_app_id!''}","${l_u_i_s.id!''}").findMenu({cache:true});
        var menuHtml = "";
        if(menuList.length>0) {
            var htm = '';
            for (var i = 0; i < menuList.length; i++) {
                var obj = menuList[i];
                if(paramsUrl==obj.url){
                    htm += '<li class="active">';
                }else{
                    if(i==0){
                        $("#home").attr('src', obj.url);
                        htm += '<li class="active">';
                    }else{
                        htm += '<li>';
                    }
                }
                if(!obj.icon){
                    obj.icon = "navicon_default";
                };
                htm += '<a href="' + obj.url + '" class="J_menuItem"';
                htm += 'target="home">';
                htm += '<span class="navicon ' + obj.icon + '"></span>';
                htm += '<span class="nav-label">'+ obj.name + '</span>';
                htm += '</a>';
                htm += '</li>';
            }
            $("#side-menu").html(htm);
            if (paramsUrl) {
                $($("#side-menu>li")[0]).removeClass("active");
                $("#home").attr('src', paramsUrl);
            }
        } else {
            $("#home").attr('src', '');
        }
        var params = window.location.search;
        if(params){
            var paramsUrl = params.split("=");
            if(paramsUrl.length==2){
                $("#home").attr("src", paramsUrl[1]);
            }else if(paramsUrl.length>2){
                paramsUrl.splice(0,1);
                var url = paramsUrl.join("=");
                $("#home").attr("src", url);
            }
        };
    });
    $("body").on("click","#side-menu li",function(){
        $("#side-menu li").removeClass("active");
        $(this).addClass("active");
    });
    $("#conclusionShow").popover({
        html: true,
        content: '<div id="content"></div>'
    }).on("mouseenter", function () {
        var _this = this;   // 这里的this触发的dom,需要存起来 否则在下面 .popover的逻辑中this会变为弹出的dom
        var isShow=$(".popover");
        if(isShow.length==0){
            $(_this).popover("show");
        };
    }).on("mouseleave", function () {
        var _this = this;
        setTimeout(function () {
            if (!$(".popover:hover").length) {
                $(_this).popover("hide");
            }
        }, 300);
    }).on("mousemove",function(){
        var isShow=$(".popover");
        if(isShow.length==0) {
            $("#conclusionShow").popover("show");
        }
    }).on('shown.bs.popover', function () {
        var ps =  $(".popoverCss li p.ptitle");
        for (var i = 0; i < ps.length; i++) {
            if(ps[i].offsetHeight > 40){
                var html = ps[i].innerText;
                var temp = "";
                ps[i].innerText = temp;
                var j = 0;
                while(ps[i].offsetHeight <= 40){
                    temp = html.substring(0, j+1);
                    j++;
                    ps[i].innerText = temp;
                }
                var leng = temp.length-2;
                ps[i].innerText=temp.substring(0,leng)+"···";
            }
        }
    });
    $("body").on("mouseleave",".popover", function () {
        setTimeout(function () {
            if (!$("#conclusionShow:hover").length) {
                $("#conclusionShow").popover("hide");
            }
        }, 300);
    });
    $("#conclusionShow").click (function(){
        window.open(gateUrl+'/gxqpt-center/admin/home?type=all');
    }) ;
</script>
</body>
</html>
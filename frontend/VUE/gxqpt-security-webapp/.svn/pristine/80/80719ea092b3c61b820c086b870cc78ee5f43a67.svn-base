<template>
  <Layout>
    <Content>
      <Breadcrumb>
        <BreadcrumbItem>咨询管理</BreadcrumbItem>
        <BreadcrumbItem>咨询申请</BreadcrumbItem>
      </Breadcrumb>
      <Card>
        <Form
          ref="formValidate"
          inline
          :label-width="100"
          :model="searchCondition">
          <FormItem label="咨询时间：">
            <DatePicker
              :value="searchCondition.referTime"
              format="yyyy-MM-dd"
              type="daterange"
              style="width: 200px">
            </DatePicker>
          </FormItem>
          <FormItem label="咨询名称：">
            <Input
              type="text"
              v-model="searchCondition.name">
            </Input>
          </FormItem>
          <FormItem label="咨询内容：">
            <Input
              type="text"
              v-model="searchCondition.content">
            </Input>
          </FormItem>
          <FormItem label="状态：">
            <Select v-model="searchCondition.status" style="width:200px">
              <Option v-for="item in statusList" :value="item.value" :key="item.value">{{item.label}}</Option>
            </Select>
          </FormItem>
          <FormItem>
            <Button type="primary" @click="search">查询</Button>
            <Button type="primary" @click="popModal(operationList.create)">新增咨询</Button>
          </FormItem>
        </Form>
        <hy-table
          highlight-row
          :columns="tableList.columns"
          :data="tableList.data"
          :total="40"
          :pageSize="10"
          pageType="small"
          show-elevator
          show-sizer
          class="refer-apply"
          @on-page-change="getList" />
        <Modal
          v-model="showModal"
          :title="modalTitle"
          id="applyModal">
          <Form
          :label-width="120"
          :model="modalContent">
            <template v-if="!(operationList.evaluate === currentOperation)">
              <FormItem label="咨询名称：">
                <Input
                  type="text"
                  v-model="modalContent.content"
                  :disabled="!isEditOrCreate">
                </Input>
              </FormItem>
              <FormItem label="咨询时间：">
                <DatePicker
                  :value="modalContent.referTime"
                  format="yyyy-MM-dd"
                  type="daterange"
                  style="width: 200px"
                  :disabled="!isEditOrCreate">
                </DatePicker>
              </FormItem>
              <FormItem label="咨询内容：">
                <Input
                  type="textarea"
                  v-model="modalContent.content"
                  :disabled="!isEditOrCreate">
                </Input>
              </FormItem>
            </template>
            <!-- 详情时需要 -->
            <template v-if="operationList.detail === currentOperation">
              <FormItem label="咨询人：">
                <Input
                  type="text"
                  v-model="modalContent.content"
                  disabled>
                </Input>
              </FormItem>
              <FormItem label="职位：">
                <Input
                  type="text"
                  v-model="modalContent.content"
                  disabled>
                </Input>
              </FormItem>
              <FormItem label="联系方式：">
                <Input
                  type="text"
                  v-model="modalContent.content"
                  disabled>
                </Input>
              </FormItem>
              <FormItem label="主要工作内容：">
                <Input
                  type="text"
                  v-model="modalContent.content"
                  disabled>
                </Input>
              </FormItem>
              <FormItem label="协助人：">
                <Input
                  type="text"
                  v-model="modalContent.content"
                  disabled>
                </Input>
              </FormItem>
            </template>
            <template v-if="operationList.evaluate === currentOperation">
              <h4>咨询评价</h4>
              <FormItem label="服务态度：">
                <Rate allow-half v-model="modalContent.rate"></Rate>
              </FormItem>
              <FormItem label="服务效率：">
                <Rate allow-half v-model="modalContent.rate"></Rate>
              </FormItem>
              <FormItem label="服务质量：">
                <Rate allow-half v-model="modalContent.rate"></Rate>
              </FormItem>
              <FormItem label="咨询建议：">
                <Input
                  type="textarea"
                  :rows="5"
                  v-model="modalContent.content">
                </Input>
              </FormItem>
            </template>
          </Form>
        </Modal>
      </Card>
    </Content>
  </Layout>
</template>

<script>
const referStatus = {
  // 已提交
  applied: 'applied',
  // 处理中
  dealing: 'dealing',
  // 已完结
  finished: 'finished',
  // 已驳回
  rejected: 'rejected'
}

const operationList = {
  // 新增
  create: 'create',
  // 详情
  detail: 'detail',
  // 评价
  evaluate: 'evaluate',
  // 修改
  edit: 'edit'
}

const statusList = [{
  label: '状态1',
  value: 1
}, {
  label: '状态2',
  value: 2
}]

export default {
  data () {
    return {
      statusList,
      operationList,
      searchCondition: {
        // 咨询时间
        referTime: [],
        // 咨询名称
        name: '',
        // 状态
        status: '',
        // 咨询内容
        content: ''
      },
      showModal: false,
      modalTitle: '',
      modalContent: {
        content: 'content',
        referTime: ['2018-01-01', '2018-01-03'],
        rate: 3.5
      },
      tableList: {
        columns: [
          {
            type: 'index',
            title: '序号',
            width: 60,
            align: 'center'
          },
          {
            title: '服务器IP',
            key: 'name'
          },
          {
            title: '进程ID',
            key: 'age'
          },
          {
            title: '进程名称',
            key: 'address'
          },
          {
            title: '用户',
            key: 'age'
          },
          {
            title: '发生日期',
            key: 'address'
          },
          {
            title: '处理状态',
            key: 'age',
            render (h, params) {
              const age = params.row.age
              switch (age) {
                case 1:
                  return '状态1'
                case 2:
                  return '状态2'
              }
            }
          },
          {
            title: '处理人',
            key: 'address'
          },
          {
            title: '处理时间',
            key: 'age'
          },
          {
            title: '操作',
            key: 'address',
            render: (h, params) => {
              const vm = this
              const age = params.row.age
              const id = params.row.age
              const info = h('span', {
                class: 'handle',
                domProps: {
                  innerHTML: '详情'
                },
                on: {
                  click () {
                    vm.$router.push({
                      path: '/referDetail',
                      name: 'referDetail',
                      params: {
                        id: 1
                      }
                    })
                  }
                }
              })
              const upgrade = h('span', {
                class: 'handle',
                domProps: {
                  innerHTML: '咨询评价'
                },
                on: {
                  click () {
                    vm.popModal(operationList.evaluate, params.row)
                  }
                }
              })
              const analyze = h('span', {
                class: 'handle',
                domProps: {
                  innerHTML: '修改'
                },
                on: {
                  click () {
                    vm.popModal(operationList.edit, params.row)
                  }
                }
              })
              switch (age) {
                case 1:
                  return h('div', [info, upgrade, analyze])
                case 2:
                  return h('div', [info, analyze])
                default:
                  return h('span', '--')
              }
            }
          }
        ],
        data: [
          {
            name: 'John Brown',
            age: 1,
            address: 'New York No. 1 Lake Park',
            date: '2016-10-03'
          },
          {
            name: 'Jim Green',
            age: 2,
            address: 'London No. 1 Lake Park',
            date: '2016-10-01'
          }
        ]
      },
      currentOperation: ''
    }
  },
  computed: {
    isEditOrCreate () {
      return this.currentOperation === operationList.create || this.currentOperation === operationList.edit
    }
  },
  methods: {
    search () {
      alert()
    },
    getList (pageNo, pageSize) {
      console.log(pageNo)
      console.log(pageSize)
    },
    popModal (operation, row) {
      if (row) {
        const status = row.name
        switch (status) {
          case referStatus.applied:

            break;
          case referStatus.dealing:

            break;
          case referStatus.finished:

            break;
          case referStatus.rejected:

            break;
        }
      }
      this.currentOperation = operation
      this.showModal = true
    }
  }
}
</script>

<style lang='less'>
.refer-apply{
  span.handle{
    margin: 0 5px;
    display: inline-block;
    cursor: pointer;
    &:hover{
      color: #2d8cf0;
    }
  }
}
#applyModal .ivu-form-item-content{
  height: auto !important;
}
</style>

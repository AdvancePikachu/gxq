<!-- 具体需求信息 -->
<template>
    <Card :bordered="false">
        <p slot="title">具体需求信息</p>
        <div style="text-align:center">
            <Form ref="evalData" :model="evalData" :label-width="150" class="clearfix">
                <Row :gutter="40">
                    <Col span="11">
                        <FormItem label="CPU核数：">
                            <Input v-model="evalData.cpuCount" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="CPU型号规格：">
                            <Input v-model="evalData.cpuModel" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="内存大小：">
                            <Input v-model="evalData.memorySize" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="内存型号规格：">
                            <Input v-model="evalData.memoryModel" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="磁盘大小：">
                            <Input v-model="evalData.diskSize" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="磁盘型号规格：">
                            <Input v-model="evalData.diskModel" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="网卡数量：">
                            <Input v-model="evalData.netcardCount" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="网卡型号规格：">
                            <Input v-model="evalData.netcardModel" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="交换机数量：">
                            <Input v-model="evalData.changeMachine" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="交换机型号规格：">
                            <Input v-model="evalData.changeModel" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="光模块数量：">
                            <Input v-model="evalData.lightCount" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="模块型号规格：">
                            <Input v-model="evalData.lightModel" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="独显存储机数量：">
                            <Input v-model="evalData.videocardCount" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="11">
                        <FormItem label="独显型号规格：">
                            <Input v-model="evalData.videocardModel" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                    <Col span="22">
                        <FormItem label="需求说明：">
                            <Input type="textarea" v-model="evalData.remark" :disabled='disab'></Input>
                        </FormItem>
                    </Col>
                </Row>
            </Form>
            <Row v-if="!disab" class="bottom-bar" style="text-align: center">
                <Col>
                    <Button type="default" @click="quit(-2)">取消</Button>
                    <Button type="primary" @click="quit(-1)">上一步</Button>
                    <Button type="primary" @click="submit">提交</Button>
                </Col>
            </Row>
        </div>
    </Card>
</template>

<script>
import api from '@/api/axiosApi'
import softhardApiList from '@/api/softhardApiList'
export default {
    props: {
        disab: {
        type: Boolean,
        default:false
        }
    },
    data(){
        return{
            dialog:false,
            msg:'',
            evalData:{
                "changeMachine": 0,
                "changeModel": "",
                "cpuCount": 0,
                "cpuModel": "",
                "diskModel": "",
                "diskSize": 0,
                "lightCount": 0,
                "lightModel": "",
                "memoryModel": "",
                "memorySize": 0,
                "netcardCount": 0,
                "netcardModel": "",
                "remark": "",
                "videocardCount": 0,
                "videocardModel": ""
            },
        }
    },
    mounted(){
        console.log(this.$route.params.id)
        if(this.$route.params.id != 1){//1:新建,2:重新提交,3:修改,4:审批,5:处理,6:查看详情
            this.getApplyResByApplyId();
        }
        console.log(this.$route.params.departData);
    },
    methods:{
        getApplyResByApplyId() { // 根据ApplyId查询申请新增所需资源
            api(softhardApiList.getApplyResByApplyId, {
                "keyid": this.$route.params.departData.id
            }).then((res) => {
                if(res.status == 200 && res.data.data) {
                    this.evalData = res.data.data;
                }else{
                    this.evalData = {};
                }
            }, (err) => {
                //dong something...
            })
        },
        quit (n) {// 取消
            this.$router.go(n)
        },
        submit(){//提交
            let test = this.evalData.cpuCount + this.evalData.memorySize + this.evalData.diskSize + this.evalData.netcardCount + this.evalData.changeMachine + this.evalData.lightCount + this.evalData.videocardCount;
            if(!!test){
                if(this.dataDeal(this.evalData)){
                    api(softhardApiList.uYApplyReseSubmit,this.evalData).then((res) => {
                        if(res.data.errcode == 0){
                            this.$router.go(-2);
                        }else{
                            this.$Message.error(res.data.errmsg);
                        }
                    }, (err) => {
                        //dong something...
                    })
                }
            }else{
                this.$Message.error('请填写至少一个模块的数量！');
            }
        },
        dataDeal(data){
            data.stepCode = 'YOUYI_HANDLER';//this.$route.params.departData.stepCode;假数据
            data.applyKeyid = this.$route.params.departData.id;
            if(data.changeMachine == 0 && data.cpuCount == 0 && data.diskSize == 0 && data.lightCount == 0 && data.memorySize == 0 && data.netcardCount == 0 && data.videocardCount == 0){
                this.$Message.error('不能全部为空');
                return false;
            }
            return true;
        },
    },
    components: {
    },
}
</script>
<style>
.download /deep/ .ivu-form-item-content{
    position: absolute;
    left:0;
}
</style>


<template>
  <Layout>
    <Content>
      <Breadcrumb>
        <BreadcrumbItem>部门用户</BreadcrumbItem>
        <BreadcrumbItem>服务器管理</BreadcrumbItem>
      </Breadcrumb>
      <Card>
        <Form
          ref="formValidate"
          inline
          :label-width="100"
          :model="serverData">
          <FormItem label="CPU：">
            <Select v-model="serverData.cpuCount" style="width:140px">
              <Option v-for="item in cpu" :value="item.value" :key="item.value">{{item.label}}</Option>
            </Select>
          </FormItem>
          <FormItem label="内存：">
            <Select v-model="serverData.memory" style="width:140px">
              <Option v-for="item in categoryList" :value="item.value" :key="item.value">{{item.label}}</Option>
            </Select>
          </FormItem>
          <FormItem label="操作系统：">
            <Select v-model="serverData.operatingSystem" style="width:200px">
              <Option v-for="item in typeList" :value="item.value" :key="item.value">{{item.label}}</Option>
            </Select>
          </FormItem>
          <FormItem label="所属网络：">
            <Select v-model="serverData.network" style="width:140px">
              <Option v-for="item in providerList" :value="item.value" :key="item.value">{{item.label}}</Option>
            </Select>
          </FormItem>
          <FormItem>
            <Button type="primary" @click="handleSubmit">查询</Button>
            <router-link to="/department/create">
              <Button type="primary">申请服务器</Button>
            </router-link>
          </FormItem>
        </Form>
        <hy-table
          highlight-row
          :columns="tableList.columns"
          :data="tableList.data"
          :total="40"
          :pageSize="10"
          pageType="small"
          show-elevator
          show-sizer
          class="access-list"
          @on-page-change="getList" />
      </Card>
    </Content>
  </Layout>
</template>

<script>
import api from '@/api/axiosApi'
import softhardApiList from '@/api/softhardApiList'
export default {
  data () {
    return {
      serverData: {//查询参数
        cpuCount:"",
        memory:"",
        operatingSystem:"",
        network:"",
      },
      pageOption: { //分页参数
        current: 1,
        total: 0,
        pageSize: 20
      },
      tableList: {
        columns: [
          {
            type: 'index',
            title: '序号',
            width: 60,
            align: 'center'
          },{
            title: '服务器ID',
            key: 'serverId'
          },{
            title: '服务器IP',
            key: 'serverIp'
          },{
            title: 'CPU核数',
            key: 'cpu'
          },{
            title: '内存',
            key: 'memorySize'
          },{
            title: '操作系统',
            key: 'system'
          },{
            title: '所属网络',
            key: 'network'
          },{
            title: '开通时间',
            key: 'openTime'
          },{
            title: '最近变更时间',
            key: 'updateTime'
          },{
					title: '变更次数',
            key: 'changeCount',
            render: (h, params) => {
              const vm = this
              const num = params.row.changeNum
              const change = h('span', {
                class: 'handle',
                domProps: {
                  innerHTML: num
                },
                on: {
                  click() {
                    vm.gotoCtrl(num)
                  }
                }
              })
              return h('div', [change])
            }
          },{
            title: '操作',
            key: 'address',
            render: (h, params) => {
              const vm = this
              const age = params.row.age
              const id = params.row.age
              const change = h('span', {
                class: 'handle',
                domProps: {
                  innerHTML: '配置变更'
                },
                on: {
                  click () {
                    vm.gotoCtrl(1)
                  }
                }
              })
              const detail = h('span', {
                class: 'handle',
                domProps: {
                  innerHTML: '详情'
                },
                on: {
                  click () {
                    vm.gotoCtrl(2)
                  }
                }
              })
              switch (age) {
                case 1:
                  return h('div', [change, detail])
                case 2:
                  return h('div', [change])
                default:
                  return h('span', '--')
              }
            }
          }
        ],
        data: []
      },
      cpu:[{
        value: 2,
        label: '2核'
      },
      {
        value: 4,
        label: '4核'
      },
      {
        value: 8,
        label: '8核'
      },
      {
        value: 16,
        label: '16核'
      }],
      categoryList: [{
        value: 2,
        label: '2GB'
      },
      {
        value: 4,
        label: '4GB'
      },
      {
        value: 8,
        label: '8GB'
      },
      {
        value: 16,
        label: '16GB'
      },
      {
        value: 32,
        label: '32GB'
      },
      {
        value: 64,
        label: '64GB'
      }],
      typeList: [{
        value: 'windows server 32 位',
        label: 'windows server 32 位'
      },{
        value: 'aliyun Linux 64位',
        label: 'aliyun Linux 64位'
      },{
        value: 'centos 32位',
        label: 'centos 32位'
      }],
      providerList: [{
        value: 'zwww',
        label: '政务外网'
      },{
        value: 'hlw',
        label: '互联网'
      },{
        value: 'zw',
        label: '专网'
      }]
    }
  },
  mounted(){
    this.servermanagerPage();
  },
  methods: {
    // 点击查询按钮
    handleSubmit () {
      alert()
    },
    // 从服务端获取列表数据
    getList (pageNo, pageSize) {
      console.log(pageNo)
      console.log(pageSize)
    },
    pageChange(num) { //页码改变的回调
      this.pageOption.current = num;
      this.servermanagerPage();
    },
    changePageSize(num) { //切换每页条数时的回调
      this.pageOption.pageSize = num;
      this.servermanagerPage();
    },
    servermanagerPage() { // 查询服务分配管理分页
      this.data = [];
      var formData = {
        "data": { ...this.serverData }, //Object.assign({}, this.serverData),
        "pageNo": this.pageOption.current,
        "pageSize": this.pageOption.pageSize
      };
      api(softhardApiList.servermanagerPage, formData).then((res) => {
        if(res.data.errcode == 0){
          this.tableList.data = res.data.data.list;
          if(this.data.length>0){
            this.pageOption.pageSize = res.data.data.pageSize;
            this.pageOption.total = res.data.data.total;
            this.pageOption.current = res.data.data.pageNum;
          };
        }else{
          console.log(res.data.errmsg);
        }
      }, (err) => {
        //dong something...
      })
    },
    // 操作
    gotoCtrl (idx) {
      // 配置变更
      if (idx === 1) {
        this.$router.push({
          path: '/department/modify'
        })
      } else {// 详情
        this.$router.push({
          path: '/department/detail'
        })
      }
    }
  }
}
</script>

<style lang='less'>
.access-list{
  span.handle{
    margin: 0 5px;
    display: inline-block;
    cursor: pointer;
    &:hover{
      color: #57a3f3;
    }
  }
}
</style>

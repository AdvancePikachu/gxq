<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
    <meta http-equiv="Expires" content="0"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="${_static}/js/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="${_static}/js/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="${_static}/js/lib/chosen/chosen.min.css">
    <link rel="stylesheet" type="text/css" href="${_static}/js/lib/My97DatePicker/skin/WdatePicker.css">
    <link rel="stylesheet" type="text/css" href="${_static}/js/lib/ValidateForm/Validform.css">
    <link rel="stylesheet" href="${_static}/themes/blue/css/ui.css">
    <link rel="stylesheet" href="${_static}/css/core/module.css">
    <link rel="stylesheet" type="text/css" href="${_static}/css/sys_com/com.css"/>
</head>

<body>
<div class="workspace-body">
    <div class="col-md-12 col-lg-12">
        <div class="row">
            <!--内容-->
            <div class="list-section">
                <div class="list-content">
                    <div class="form-inline">
                        <form autocomplete="off" id="myForm" action="" method="post">
                            <table class="table default-table table-title-left table-top-30">
                                <tbody>
                                <tr>
                                    <th width="130"><sub class="required">*</sub>名称</th>
                                    <td><input class="form-control inp-form" name="name" dataType="*1-64" nullmsg="名称不能为空" errormsg="只能输入1-64个字符"/></td>
                                </tr>
                                <tr>
                                    <th><sub class="required">*</sub>编码</th>
                                    <td><input class="form-control inp-form" name="number" readonly></td>
                                </tr>
                                <tr>
                                    <th><sub class="required">*</sub>是否启用</th>
                                    <td>
                                        <select name="status" class="form-control chosen-select set-form" dataType="*" nullmsg="所属级别不能为空">
                                            <option value="1">是</option>
                                            <option value="0">否</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th>日历类型</th>
                                    <td>
                                        <select class="form-control inp-form" onchange="switchType(this) " id="calendarType" name="calendarType">
                                            <option value="1">阳历</option>
                                            <option value="0">阴历</option>
                                        </select>
                                        <input type="hidden" id="startDate" name="startDate"/>
                                    </td>
                                </tr>
                                <tr style="position: relative" id="type1">
                                    <th><sub class="required">*</sub>开始日期</th>
                                    <td>
                                        <input type="text" class="form-control inp-form Wdate" onfocus="WdatePicker({dateFmt: 'MM-dd'})" id="ystartDate" name="ystartDate" dataType="*" nullmsg="开始日期不能为空"/>
                                    </td>
                                </tr>
                                <tr style="position: relative;display: none" id="type2">
                                    <th><sub class="required">*</sub>开始日期</th>
                                    <td>
                                        农历月份：
                                        <select name="lmonth" id="lmonth" dataType="*" nullmsg="农历月份不能为空">
                                            <option value="">-请选择-</option>
                                            <option value="01">正月</option>
                                            <option value="02">二月</option>
                                            <option value="03">三月</option>
                                            <option value="04">四月</option>
                                            <option value="05">五月</option>
                                            <option value="06">六月</option>
                                            <option value="07">七月</option>
                                            <option value="08">八月</option>
                                            <option value="09">九月</option>
                                            <option value="10">十月</option>
                                            <option value="11">冬月</option>
                                            <option value="12">腊月</option>
                                        </select>
                                        农历日期：
                                        <select name="lday" id="lday" dataType="*" nullmsg="农历日期不能为空">
                                            <option value="">-请选择-</option>
                                            <option value="01">初一</option>
                                            <option value="02">初二</option>
                                            <option value="03">初三</option>
                                            <option value="04">初四</option>
                                            <option value="05">初五</option>
                                            <option value="06">初六</option>
                                            <option value="07">初七</option>
                                            <option value="08">初八</option>
                                            <option value="09">初九</option>
                                            <option value="10">初十</option>
                                            <option value="11">十一</option>
                                            <option value="12">十二</option>
                                            <option value="13">十三</option>
                                            <option value="14">十四</option>
                                            <option value="15">十五</option>
                                            <option value="16">十六</option>
                                            <option value="17">十七</option>
                                            <option value="18">十八</option>
                                            <option value="19">十九</option>
                                            <option value="20">二十</option>
                                            <option value="21">廿一</option>
                                            <option value="22">廿二</option>
                                            <option value="23">廿三</option>
                                            <option value="24">廿四</option>
                                            <option value="25">廿五</option>
                                            <option value="26">廿六</option>
                                            <option value="27">廿七</option>
                                            <option value="28">廿八</option>
                                            <option value="29">廿九</option>
                                            <option value="30">三十</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th><sub class="required">*</sub>持续天数</th>
                                    <td><input type="text" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" class="form-control inp-form" name="holidayDays" dataType="/^([1-9]|[1][0-9]|20)$/"  errormsg="只能输入20以内的正整数" nullmsg="持续天数不能为空"></td>
                                </tr>
                                <tr>
                                    <th>有效开始时间</th>
                                    <td><input class="form-control inp-form Wdate" name="starTime"  onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd'})"/></td>
                                </tr>
                                <tr>
                                    <th>有效截止时间</th>
                                    <td>
                                        <input class="form-control inp-form Wdate" name="endTime" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd'})">
                                    </td>
                                </tr>
                                <tr>
                                    <th>描述</th>
                                    <td>
                                        <textarea class="form-control inp-form" name="story" dataType="*0-64"  errormsg="只能输入0-64个字符"></textarea>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <button type="hidden" class="btn-submit hidden"></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="${_static}/js/lib/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="${_static}/js/lib/chosen/chosen.jquery.min.js"></script>
<script type="text/javascript" src="${_static}/js/lib/serializeJSON/jquery.serializejson.min.js"></script>
<script type="text/javascript" src="${_static}/js/lib/ValidateForm/Validform_v5.3.2_min.js"></script>
<script type="text/javascript" src="${_static}/js/lib/ValidateForm/Valid.js"></script>
<script type="text/javascript" src="${_static}/js/hengyun/hengyun_ajax.js"></script>
<script type="text/javascript" src="${_static}/js/lib/jquery/jquery.cookie.js" charset="utf-8"></script>
<script src="${_static}/js/lib/layer/layer.js"></script>
<script type="text/javascript">
    var Index = null;
    var urlPrev = '${_gate_url}/api/admin/';
    //获取节假日元数据详情
    (function () {
        ajaxHengyun({
            url: urlPrev+'holiday/getHolidayOriginal?id=${id}',
            type: 'get',
            success: function (res) {
                if (res.data) {
                    $('[name="name"]').val(res.data.name);
                    $('[name="number"]').val(res.data.number);
                    $('[name="status"]').val(res.data.status);
                    $('[name="calendarType"]').val(res.data.calendarType);
                    $('[name="startDate"]').val(res.data.month + '-' + res.data.day);
                    $('[name="holidayDays"]').val(res.data.holidayDays);
                    $('[name="starTime"]').val(res.data.starTime);
                    $('[name="endTime"]').val(res.data.endTime);
                    $('[name="story"]').val(res.data.story);

                    if(res.data.calendarType=='0'){
                        $("#lmonth").val(res.data.month);
                        $("#lday").val(res.data.day);
                        $('#type1').hide();
                        $('#type2').show();
                    }else {
                        $('[name="ystartDate"]').val(res.data.month + '-' + res.data.day);
                        $('#type2').hide();
                        $('#type1').show();
                    }
                }
            }
        })
    })();
    //初始化表单验证插件
    $('.btn-submit').valid({
        form: '#myForm',
        showAllError: true,
        ignoreHidden: true,
        checkpassed: function () {
            if($("#calendarType").val()=='1'){
                $("#startDate").val($("#ystartDate").val());
            }else {
                $("#startDate").val($("#lmonth").val()+"-"+$("#lday").val());
            }
            var data = $('#myForm').serializeJSON();
            data.id = '${id}';
            ajaxHengyun({
                url: urlPrev+'holiday/update',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    if (res.data) {
                        parent.layer.msg('修改成功',{icon:6});
                        parent.home.reloadCalendarList();
                        parent.layer.close(Index);
                    }else {
                        parent.layer.msg(res.errmsg,{icon:6});
                    }
                }
            })
        }
    });
    function save(index) {
        Index = index;
        $('.btn-submit').click();
    }
    function switchType(obj) {
        if(obj.value=='0'){
            $('#type1').hide();
            $('#type2').show();
        }else {
            $('#type2').hide();
            $('#type1').show();
        }
    }
</script>
</body>

</html>